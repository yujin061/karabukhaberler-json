name: Karabuk Haberler JSON GÃ¼ncelleme

on:
  schedule:
    - cron: '0 */4 * * *' # Her saat Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r
  workflow_dispatch: # Manuel tetikleme iÃ§in

jobs:
  update-json:
    runs-on: ubuntu-latest

    steps:
      - name: Repository'i checkout yap
        uses: actions/checkout@v4

      - name: JSON verisini Ã§ek ve dÃ¼zenle
        run: |
          curl -s https://services.karabuk.bel.tr/jsons-karabukbeltr/data/data-haberler.json | \
          sed 's/^var data = //' | \
          sed 's/;$//' | \
          jq '[.haberler[] | select(.haberkisa != "") | {
            kategoriadi: .kategoriadi,
            haberresim: .haberresim,
            haberbaslik: .haberbaslik,
            haberkisa: .haberkisa,
            tarih: .tarih,
            detay_url: (.haberdetay | gsub("<[^>]*>"; "") | gsub("&quot;"; "\"") | gsub("&Ccedil;"; "Ã‡") | gsub("&ccedil;"; "Ã§") | gsub("&Ouml;"; "Ã–") | gsub("&ouml;"; "Ã¶") | gsub("&Uuml;"; "Ãœ") | gsub("&uuml;"; "Ã¼") | gsub("&rsquo;"; "â€™") | gsub("&nbsp;"; " ") | gsub("&ldquo;"; "â€œ") | gsub("&rdquo;"; "â€") | gsub("&ndash;"; "â€“") | gsub("&mdash;"; "â€”") | gsub("&amp;"; "&") | gsub("&lsquo;"; "â€˜") | gsub("&hellip;"; "â€¦") | gsub("&aacute;"; "Ã¡") | gsub("&eacute;"; "Ã©") | gsub("&iacute;"; "Ã­") | gsub("&oacute;"; "Ã³") | gsub("&uacute;"; "Ãº") | gsub("&ntilde;"; "Ã±") | gsub("&uuml;"; "Ã¼") | gsub("&#39;"; "'") | gsub("&deg;"; "Â°") | gsub("\n"; "") | gsub("\t"; "") | gsub(" +"; " ") | trim)
          }]' > data-haberler.json

      - name: DeÄŸiÅŸiklikleri commit ve push et
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data-haberler.json
          git commit -m "ğŸ”„ data-haberler.json otomatik olarak gÃ¼ncellendi" || echo "DeÄŸiÅŸiklik yok"
          git push
