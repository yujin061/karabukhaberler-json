#!/bin/bash

# JSON verisini çek ve raw-data.json dosyasına kaydet
curl -s https://services.karabuk.bel.tr/jsons-karabukbeltr/data/data-haberler.json -o raw-data.json

# raw-data.json dosyasını kontrol et ve temizle
cat raw-data.json | \
sed 's/^var data = //' | sed 's/;$//' | \
jq '[.haberler[] | select(.haberkisa != "") | {
  kategoriadi: .kategoriadi,
  haberresim: .haberresim,
  haberbaslik: .haberbaslik,
  haberkisa: .haberkisa,
  tarih: .tarih,
  detay_url: (.haberdetay | gsub("<[^>]*>"; "") | gsub("&quot;"; "\"") | gsub("&Ccedil;"; "Ç") | gsub("&ccedil;"; "ç") | gsub("&Ouml;"; "Ö") | gsub("&ouml;"; "ö") | gsub("&Uuml;"; "Ü") | gsub("&uuml;"; "ü") | gsub("&rsquo;"; "’") | gsub("&nbsp;"; " ") | gsub("&ldquo;"; "“") | gsub("&rdquo;"; "”"))
}]' > data-haberler.json

# İşlem tamamlandığında mesaj göster
if [ $? -eq 0 ]; then
  echo "JSON verisi başarıyla işlendi ve data-haberler.json dosyasına kaydedildi."
else
  echo "Bir hata oluştu, lütfen verileri kontrol edin."
fi
